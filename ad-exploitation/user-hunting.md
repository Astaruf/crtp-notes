# User Hunting

Find all machines on the current domain where the current user has local admin access.

> This function queries the DC of the current or provided domain for a list of computers (GetNetComputer) and then use multi-threaded Invoke-CheckLocalAdminAccess on each machine.
>
> This can also be done with the help of remote administration tools like WMI and PowerShell remoting. Pretty useful in cases ports (RPC and SMB) used by Find-LocalAdminAccess are blocked.
>
> See **Find-WMILocalAdminAccess.ps1** and **Find-PSRemotingLocalAdminAccess.ps1**

```powershell
Find-LocalAdminAccess -Verbose
```

Find computers where a domain admin (or specified user/group) has sessions:

> This function queries the DC of the current or provided domain for members of the given group (Domain Admins by default) using Get-DomainGroupMember, gets a list of computers (Get-DomainComputer) and list sessions and logged on users (Get-NetSession/Get-NetLoggedon) from each machine.
>
> Note that for Server 2019 and onwards, local administrator privileges are required to list sessions.

```powershell
Find-DomainUserLocation -Verbose
Find-DomainUserLocation -UserGroupIdentity "RDPUsers"
```

Find computers where a domain admin session is available and current user has admin access (uses Test-AdminAccess).

```powershell
Find-DomainUserLocation -CheckAccess
```

Find computers (File Servers and Distributed File servers) where a domain admin session is available.

```powershell
Find-DomainUserLocation -Stealth
```

List sessions on remote machines ([https://github.com/Leo4j/InvokeSessionHunter](https://github.com/Leo4j/InvokeSessionHunter)). This command doesnâ€™t need admin access on remote machines. Uses Remote Registry and queries HKEY\_USERS hive.

```powershell
Invoke-SessionHunter -FailSafe
```

An opsec friendly command would be:

```powershell
Invoke-SessionHunter -NoPortScan -Targets C:\AD\Tools\servers.txt
```

